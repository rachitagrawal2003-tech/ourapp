{% extends 'base.html' %}

{% block title %}Chocolate Day - Feb 9{% endblock %}

{% block extra_css %}
<style>
    canvas {
        touch-action: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="text-center mb-8">
    <h1 class="text-5xl md:text-7xl font-dancing text-amber-700 dark:text-amber-500 mb-4 animate-float">
        Sweet Surprises
    </h1>
    <p class="text-xl text-gray-700 dark:text-gray-300">
        Scratch to reveal your treats!
    </p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-5xl mx-auto w-full px-4">

    <!-- Card 1 -->
    <div class="flex flex-col items-center">
        <h2 class="text-2xl font-dancing font-bold text-valentine-800 dark:text-valentine-200 mb-4">Chocolate</h2>
        <div class="relative w-full aspect-[4/3] glass rounded-xl overflow-hidden shadow-xl group">
            <!-- Hidden Content -->
            <div class="absolute inset-0 flex items-center justify-center bg-valentine-100 dark:bg-gray-800">
                <h2 class="text-3xl md:text-4xl font-dancing text-valentine-600 text-center px-4">
                    You da real chocolate hehe üç´
                </h2>
            </div>
            <!-- Scratch Surface -->
            <canvas id="scratch1" class="absolute inset-0 w-full h-full cursor-pointer"></canvas>
        </div>
    </div>

    <!-- Card 2 -->
    <div class="flex flex-col items-center">
        <h2 class="text-2xl font-dancing font-bold text-amber-600 dark:text-amber-400 mb-4">Golden Chocolate</h2>
        <div class="relative w-full aspect-[4/3] glass rounded-xl overflow-hidden shadow-xl group">
            <!-- Hidden Content -->
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-amber-100 dark:bg-gray-800 p-4">
                <i class="fas fa-ticket-alt text-6xl text-yellow-500 mb-4 animate-pulse"></i>
                <h3 class="text-2xl font-bold text-amber-800 dark:text-amber-500 mb-4">Golden Ticket</h3>
                <a href="https://open.spotify.com/playlist/5ofsPCZQATe612aMSyAJMh?si=uq-2Yne8QN2XPT0qSLnwdg&pi=rrOGA8rDQhio-"
                    target="_blank"
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-transform hover:scale-105 z-20 relative">
                    Claim on Spotify <i class="fab fa-spotify ml-2"></i>
                </a>
            </div>
            <!-- Scratch Surface -->
            <canvas id="scratch2" class="absolute inset-0 w-full h-full cursor-pointer"></canvas>
        </div>
    </div>

</div>

<script>
    function setupScratchCard(canvasId, overlayColor = '#b45309') {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        // Set dimensions
        function resize() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            // Fill with overlay color
            ctx.fillStyle = overlayColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add label
            ctx.fillStyle = '#ffffff';
            ctx.font = '30px "Dancing Script"';
            ctx.textAlign = 'center';
            ctx.fillText("Scratch Me!", canvas.width / 2, canvas.height / 2);
        }

        // Initial resize
        resize();
        window.addEventListener('resize', () => {
            // Only resize if not scratched much? Re-filling destroys progress. 
            // For simplicity, we won't re-fill on resize, just let CSS handle scaling visual
        });

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.changedTouches) {
                clientX = e.changedTouches[0].clientX;
                clientY = e.changedTouches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function scratch(e) {
            if (!isDrawing) return;
            e.preventDefault();

            const pos = getMousePos(e);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 30, 0, Math.PI * 2);
            ctx.fill();
        }

        // Mouse Events
        canvas.addEventListener('mousedown', (e) => { isDrawing = true; scratch(e); });
        canvas.addEventListener('mousemove', scratch);
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        // Touch Events
        canvas.addEventListener('touchstart', (e) => { isDrawing = true; scratch(e); }, { passive: false });
        canvas.addEventListener('touchmove', scratch, { passive: false });
        canvas.addEventListener('touchend', () => isDrawing = false);
    }

    // Initialize both cards
    // Using a timeout to ensure DOM is fully ready/sized
    setTimeout(() => {
        setupScratchCard('scratch1', '#78350f'); // Dark chocolate color
        setupScratchCard('scratch2', '#d97706'); // Goldish color
    }, 100);
</script>
{% endblock %}