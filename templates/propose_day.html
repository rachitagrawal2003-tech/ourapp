{% extends 'base.html' %}

{% block title %}Propose Day - Feb 8{% endblock %}

{% block extra_css %}
<style>
    .no-btn {
        transition: all 0.2s ease;
        position: relative;
    }

    .slide {
        display: none;
    }

    .slide.active {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: #f00;
        animation: confetti-fall linear forwards;
    }

    @keyframes confetti-fall {
        0% {
            transform: translateY(-10vh) rotate(0deg);
        }

        100% {
            transform: translateY(110vh) rotate(720deg);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="w-full max-w-4xl mx-auto flex flex-col items-center">

    <!-- Pitch Deck Carousel -->
    <div id="carousel-container"
        class="relative w-full max-w-lg aspect-square bg-black/10 rounded-2xl overflow-hidden glass shadow-2xl mb-8 group">
        {% for i in range(1, 7) %}
        <div class="slide w-full h-full {% if i == 1 %}active{% endif %}">
            <img src="/assets/memories/slide{{ i }}.jpg" alt="Memory {{ i }}" class="w-full h-full object-cover">
        </div>
        {% endfor %}

        <!-- Navigation -->
        <button onclick="changeSlide(-1)"
            class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 p-4 rounded-full text-white backdrop-blur-sm transition-all z-20">
            <i class="fas fa-chevron-left text-2xl"></i>
        </button>
        <button onclick="changeSlide(1)"
            class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 p-4 rounded-full text-white backdrop-blur-sm transition-all z-20">
            <i class="fas fa-chevron-right text-2xl"></i>
        </button>

        <!-- Indicators -->
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
            {% for i in range(1, 7) %}
            <div class="dot w-3 h-3 rounded-full bg-white/50 cursor-pointer transition-all {% if i == 1 %}bg-white scale-125{% endif %}"
                onclick="goToSlide({{ i - 1 }})"></div>
            {% endfor %}
        </div>
    </div>

    <!-- Final Proposal Section (Initially Hidden or revealed after slides) -->
    <div id="proposal-section" class="w-full text-center hidden active">
        <div
            class="relative w-full max-w-2xl mx-auto glass p-8 rounded-2xl transform transition-all duration-500 hover:scale-105">
            <img src="/assets/memories/willyoubemyvalentine.jpg" alt="Will You Be My Valentine?"
                class="w-full rounded-xl mb-6 shadow-md">

            <h2 class="text-4xl font-dancing text-valentine-700 dark:text-valentine-300 mb-8">Will you be my Valentine?
            </h2>

            <div class="flex justify-center gap-8 items-center h-20">
                <button onclick="sayYes()"
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-110 text-xl">
                    YES! <i class="fas fa-heart ml-2"></i>
                </button>

                <button id="no-btn" onmouseover="moveButton()" onclick="moveButton()"
                    class="no-btn bg-gray-400 text-white font-bold py-3 px-8 rounded-full shadow-lg text-xl">
                    No
                </button>
            </div>
        </div>
    </div>

</div>

<!-- Full screen celebration overlay -->
<div id="celebration"
    class="fixed inset-0 z-50 pointer-events-none hidden bg-black/50 flex items-center justify-center">
    <div class="text-center animate-bounce">
        <h1 class="text-6xl md:text-9xl font-dancing text-white drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)]">
            Yay! I Love You! ❤️
        </h1>
    </div>
</div>

<script>
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.dot');
    const totalSlides = slides.length;

    function showSlide(n) {
        slides.forEach(s => s.classList.remove('active'));
        dots.forEach(d => {
            d.classList.remove('bg-white', 'scale-125');
            d.classList.add('bg-white/50');
        });

        currentSlide = (n + totalSlides) % totalSlides;

        slides[currentSlide].classList.add('active');
        dots[currentSlide].classList.remove('bg-white/50');
        dots[currentSlide].classList.add('bg-white', 'scale-125');

        // Show proposal on last slide or always? User requirement implies transitions. 
        // Let's keep proposal visible below for flow, or auto-scroll to it on last slide.
        const proposal = document.querySelector('#proposal-section');
        if (proposal.classList.contains('hidden')) {
            proposal.classList.remove('hidden');
            proposal.classList.add('animate-fade-in-up');
        }
    }

    function changeSlide(n) {
        showSlide(currentSlide + n);
    }

    function goToSlide(n) {
        showSlide(n);
    }

    // Auto advance REMOVED


    // No Button Logic
    const noBtn = document.getElementById('no-btn');
    function moveButton() {
        const x = Math.random() * (window.innerWidth - noBtn.offsetWidth - 40);
        const y = Math.random() * (window.innerHeight - noBtn.offsetHeight - 40);

        noBtn.style.position = 'fixed';
        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
    }

    // Yes Button Logic
    function sayYes() {
        const celebration = document.getElementById('celebration');
        celebration.classList.remove('hidden');

        // Confetti
        for (let i = 0; i < 100; i++) {
            createConfetti();
        }

        const colors = ['#ff0000', '#ff69b4', '#ffffff', '#ffd700'];

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
            confetti.style.fontSize = Math.random() * 20 + 10 + 'px';

            // Maybe shapes?
            if (Math.random() > 0.5) {
                confetti.style.borderRadius = '50%';
            } else {
                confetti.innerHTML = '<i class="fas fa-heart"></i>';
                confetti.style.backgroundColor = 'transparent';
                confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
            }

            document.body.appendChild(confetti);

            setTimeout(() => confetti.remove(), 5000);
        }

        setInterval(() => {
            if (!celebration.classList.contains('hidden')) createConfetti();
        }, 100);
    }
</script>
{% endblock %}