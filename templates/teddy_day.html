{% extends 'base.html' %}

{% block title %}Teddy Day - Feb 10{% endblock %}

{% block extra_css %}
<style>
    @keyframes shake-violent {

        0%,
        100% {
            transform: translateX(0);
        }

        10%,
        30%,
        50%,
        70%,
        90% {
            transform: translateX(-10px) rotate(-5deg);
        }

        20%,
        40%,
        60%,
        80% {
            transform: translateX(10px) rotate(5deg);
        }
    }

    .shake {
        animation: shake-violent 0.5s cubic-bezier(.36, .07, .19, .97) both;
        animation-iteration-count: infinite;
    }

    .hidden-force {
        display: none !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[70vh] w-full">

    <div id="gift-container"
        class="relative cursor-pointer transition-transform duration-300 hover:scale-110 active:scale-95">
        <!-- Gift Box -->
        <div id="gift-box" class="text-9xl md:text-[15rem] text-valentine-600 drop-shadow-2xl">
            <i class="fas fa-gift"></i>
        </div>

        <p id="instruction" class="text-center mt-8 text-xl text-gray-600 dark:text-gray-300 animate-pulse">
            Tap to open!
        </p>
    </div>

    <!-- Revealed Teddy -->
    <div id="teddy-reveal" class="hidden opacity-0 transition-opacity duration-1000 flex-col items-center">
        <div
            class="relative w-80 h-80 md:w-96 md:h-96 rounded-full overflow-hidden border-8 border-valentine-300 shadow-2xl mb-8">
            <img src="/assets/teddy.jpg" alt="Cute Teddy" class="w-full h-full object-cover">
        </div>
        <h2 class="text-4xl font-dancing text-valentine-700 dark:text-valentine-300">
            A cuddly hug for you!
        </h2>
    </div>

</div>

<script>
    const giftContainer = document.getElementById('gift-container');
    const giftBox = document.getElementById('gift-box');
    const instruction = document.getElementById('instruction');
    const teddyReveal = document.getElementById('teddy-reveal');
    let isOpening = false;

    giftContainer.addEventListener('click', () => {
        if (isOpening) return;
        isOpening = true;

        // Start shaking
        giftBox.classList.add('shake');
        instruction.textContent = "Opening...";

        // After 1.5 seconds, explode/open
        setTimeout(() => {
            giftBox.classList.remove('shake');
            giftBox.style.transform = "scale(1.5)";
            giftBox.style.opacity = "0";
            giftBox.style.transition = "all 0.5s ease-out";

            instruction.style.opacity = "0";

            setTimeout(() => {
                giftContainer.classList.add('hidden-force');
                teddyReveal.classList.remove('hidden');

                // Trigger reflow
                void teddyReveal.offsetWidth;

                teddyReveal.classList.remove('opacity-0');

                // Add some hearts
                createExplosion();
            }, 500);

        }, 1500);
    });

    function createExplosion() {
        for (let i = 0; i < 30; i++) {
            const heart = document.createElement('div');
            heart.innerHTML = '<i class="fas fa-heart"></i>';
            heart.classList.add('fixed', 'text-valentine-500', 'text-2xl', 'pointer-events-none');
            heart.style.left = '50%';
            heart.style.top = '50%';
            heart.style.transform = `translate(-50%, -50%)`;

            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 200 + 100;

            document.body.appendChild(heart);

            const animation = heart.animate([
                { transform: 'translate(-50%, -50%) scale(0)' },
                { transform: `translate(calc(-50% + ${Math.cos(angle) * velocity}px), calc(-50% + ${Math.sin(angle) * velocity}px)) scale(1.5)`, opacity: 0 }
            ], {
                duration: 1000,
                easing: 'cubic-bezier(0, .9, .57, 1)'
            });

            animation.onfinish = () => heart.remove();
        }
    }
</script>
{% endblock %}